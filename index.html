<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸŽ® Ø¯Ú©ØªØ± N â€“ Ù…Ø§Ø´ÛŒÙ† Ø³Ú©Ù‡â€ŒØ§ÛŒ Ù„Ø§Ú©Ú†Ø±ÛŒ</title>
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-font-face.css" rel="stylesheet">
<style>
  body, html { margin:0; padding:0; overflow:hidden; background: linear-gradient(135deg,#ffe082,#f48fb1); font-family: Vazirmatn; }
  #logo { position:absolute; top:10px; left:50%; transform:translateX(-50%); font-size:32px; color:#fff; text-shadow:0 0 10px #000; animation: bounce 1.5s infinite;}
  @keyframes bounce { 0%,100%{transform:translate(-50%,0)} 50%{transform:translate(-50%,-10px);} }
  canvas { display:block; margin:auto; background: linear-gradient(to bottom,#bbdefb,#e3f2fd); border:5px solid #fff; border-radius:16px; box-shadow:0 0 30px #ff4081aa; }
  .panel { position:absolute; top:60px; left:50%; transform:translateX(-50%); background:rgba(255,255,255,0.95); padding:20px; border-radius:16px; box-shadow:0 0 30px #00000055; width:320px; text-align:center; z-index:10; display:none; }
  input,select,button { width:100%; padding:12px; margin-top:10px; border:none; border-radius:8px; font-size:16px; }
  button { background: linear-gradient(to right,#ec407a,#d81b60); color:#fff; font-weight:bold; cursor:pointer; transition:0.2s; }
  button:hover { transform:scale(1.03); }
  #progressBarContainer { position:absolute; bottom:120px; left:50%; transform:translateX(-50%); width:80%; max-width:400px; background:#ffebee; border-radius:10px; height:22px; box-shadow:inset 0 1px 3px rgba(0,0,0,0.2); z-index:10; display:none;}
  #progressBar { width:0%; height:100%; background:linear-gradient(to right,#ef5350,#e53935); border-radius:10px; transition:width 0.4s ease; }
  #transferPanel { top:130px; }
  #scoreList { text-align:left; max-height:200px; overflow-y:auto; margin-top:10px; direction:ltr; }
</style>
</head>
<body>
<div id="logo">ðŸŽ‰ Ø¯Ú©ØªØ±Â N â€“ Ù…Ø§Ø´ÛŒÙ† Ø³Ú©Ù‡â€ŒØ§ÛŒ Ù„Ø§Ú©Ú†Ø±ÛŒ</div>
<canvas id="gameCanvas" width="400" height="600"></canvas>

<div id="loginPanel" class="panel">
  <h3>ÙˆØ±ÙˆØ¯ / ÙˆØ±ÙˆØ¯ Ù…Ø¯ÛŒØ±</h3>
  <input id="licenseCode" placeholder="Ú©Ø¯ Ù„Ø§ÛŒØ³Ù†Ø³">
  <button onclick="login()">ÙˆØ±ÙˆØ¯ Ú©Ø§Ø±Ø¨Ø±</button>
  <button onclick="adminLogin()">Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª</button>
  <div id="scoreList"></div>
</div>

<div id="adminPanel" class="panel">
  <h3>Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§ÛŒØ³Ù†Ø³</h3>
  <input id="adminCode" placeholder="Ú©Ø¯ Ù„Ø§ÛŒØ³Ù†Ø³">
  <input id="duration" type="number" placeholder="Ù…Ø¯Øª (Ø±ÙˆØ²)" min="1">
  <select id="tier"><option value="bronze">Ø¨Ø±Ù†Ø²</option><option value="silver">Ù†Ù‚Ø±Ù‡</option><option value="gold">Ø·Ù„Ø§</option></select>
  <button onclick="generateOrChargeLicense()">Ø«Ø¨Øª / Ø´Ø§Ø±Ú˜</button>
  <div id="adminOutput"></div>
</div>

<div id="transferPanel" class="panel">
  <h3>Ø§Ù†ØªÙ‚Ø§Ù„ Ù¾ÙˆÙ„</h3>
  <input id="recipientCode" placeholder="Ú©Ø¯ 6 Ø±Ù‚Ù…ÛŒ Ú¯ÛŒØ±Ù†Ø¯Ù‡">
  <input id="transferAmount" type="number" placeholder="Ù…Ø¨Ù„Øº (ØªÙˆÙ…Ø§Ù†)">
  <button onclick="transferCoins()">Ø§Ø±Ø³Ø§Ù„</button>
</div>

<div id="progressBarContainer"><div id="progressBar"></div></div>

<script>
let licenseCode='', tier='bronze', coinCount=0;
const values={bronze:2000,silver:4000,gold:6000}, dragons=[], coinsArr=[];

// Ù…Ø¯ÛŒØ±ÛŒØª Ù„Ø§ÛŒØ³Ù†Ø³
function login(){
  const code=document.getElementById('licenseCode').value.trim();
  const lic=JSON.parse(localStorage.getItem('licenses')||'{}')[code];
  if(lic && Date.now()<lic.expires){
    licenseCode=code; tier=lic.tier; coinCount=lic.coins||0;
    document.getElementById('loginPanel').style.display='none';
    document.getElementById('adminPanel').style.display='none';
    document.getElementById('transferPanel').style.display='block';
    document.getElementById('progressBarContainer').style.display='block';
    updateProgressBar(lic); loadScores();
    startGame();
  } else alert('Ú©Ø¯ Ø§Ø´ØªØ¨Ø§Ù‡ ÛŒØ§ Ù…Ù†Ù‚Ø¶ÛŒ!')
}

function adminLogin(){
  const pass=prompt('Ø±Ù…Ø² Ù…Ø¯ÛŒØ±:');
  if(pass==='Ali.dr.N.'){
    document.getElementById('loginPanel').style.display='none';
    document.getElementById('adminPanel').style.display='block';
    document.getElementById('transferPanel').style.display='none';
  } else alert('Ø±Ù…Ø² Ø§Ø´ØªØ¨Ø§Ù‡!')
}

function generateOrChargeLicense(){
  const code=document.getElementById('adminCode').value.trim(), days=parseInt(document.getElementById('duration').value), t=document.getElementById('tier').value;
  if(!code||!days)return alert('Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ!');
  const a=JSON.parse(localStorage.getItem('licenses')||'{}');
  const now=Date.now();
  a[code]={tier:t,expires:now+days*86400000,totalDays:days,coins: a[code]?a[code].coins:0};
  localStorage.setItem('licenses',JSON.stringify(a));
  document.getElementById('adminOutput').innerText=`âœ… ${code} Ø¨Ø±Ø§ÛŒ ${days} Ø±ÙˆØ² Ø«Ø¨Øª Ø´Ø¯`;
}

function transferCoins(){
  const r=document.getElementById('recipientCode').value.trim(), amt=parseInt(document.getElementById('transferAmount').value);
  const lic=JSON.parse(localStorage.getItem('licenses')||'{}');
  if(!lic[licenseCode])return alert('Ø§Ø¨ØªØ¯Ø§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯');
  if(isNaN(amt)||amt<1)return alert('Ø¹Ø¯Ø¯ ØµØ­ÛŒØ­!');
  if(lic[licenseCode].coins*values[lic[licenseCode].tier]<amt)return alert('Ø§Ø¹ØªØ¨Ø§Ø± Ú©Ù… Ø§Ø³Øª');
  const rec=Object.values(lic).find(v=>v.code&&v.code.toString()===r);
  if(!rec)return alert('Ú¯ÛŒØ±Ù†Ø¯Ù‡ ÛŒØ§ÙØª Ù†Ø´Ø¯');
  lic[licenseCode].coins-=Math.floor(amt/values[tier]);
  rec.coins+=Math.floor(amt/values[rec.tier]);
  localStorage.setItem('licenses',JSON.stringify(lic));
  alert('Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯'); loadScores();
}

// Ù¾ÛŒØ´Ø±ÙØª Ø§Ø´ØªØ±Ø§Ú©
function updateProgressBar(lic){
  const daysLeft=Math.ceil((lic.expires-Date.now())/86400000);
  const perc=Math.max(0,Math.min(100,daysLeft/lic.totalDays*100));
  document.getElementById('progressBar').style.width=perc+'%';
  document.getElementById('progressBar').title=daysLeft+' Ø±ÙˆØ² Ø¨Ø§Ù‚ÛŒ';
}

// Ø¬Ø¯ÙˆÙ„ Ø§Ù…ØªÛŒØ§Ø²Ø§Øª
function loadScores(){
  const lic=JSON.parse(localStorage.getItem('licenses')||'{}');
  const arr=Object.entries(lic).map(([k,v])=> ({code:k,coins:v.coins||0})).sort((a,b)=>b.coins-a.coins);
  const html=arr.slice(0,5).map(o=>`${o.code}: ${o.coins} Ø³Ú©Ù‡`).join('<br>');
  document.getElementById('scoreList').innerHTML=html;
}

// Ø¨Ø§Ø²ÛŒ Ù…Ø§Ø´ÛŒÙ†
const canvas=document.getElementById('gameCanvas'), ctx=canvas.getContext('2d');
const car={x:180,y:520,w:40,h:60,color:'#d32f2f'};
let gameInterval;

function startGame(){
  dragons.length=0; coinsArr.length=0;
  document.addEventListener('keydown',e=>{
    if(e.key==='ArrowLeft')car.x=Math.max(0,car.x-30);
    if(e.key==='ArrowRight')car.x=Math.min(canvas.width-car.w,car.x+30);
  });
  gameInterval=setInterval(updateGame,30);
}

function updateGame(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle=car.color; ctx.fillRect(car.x,car.y,car.w,car.h);
  if(Math.random()<0.02) dragons.push({x:Math.random()*360+20,y:-60});
  if(Math.random()<0.05) coinsArr.push({x:Math.random()*360+20,y:-20});

  dragons.forEach((d,i)=>{
    d.y+=4; ctx.fillStyle='#666'; ctx.beginPath();
    ctx.moveTo(d.x,d.y); ctx.lineTo(d.x-15,d.y+40); ctx.lineTo(d.x+15,d.y+40); ctx.fill();
    if(d.y>canvas.height||d.y>car.y && Math.abs(d.x-car.x)<30) dragons.splice(i,1);
  });

  coinsArr.forEach((c,i)=>{
    c.y+=5; ctx.beginPath(); ctx.arc(c.x,c.y,10,0,2*Math.PI);
    ctx.fillStyle='gold'; ctx.fill();
    if(c.y>canvas.height)coinsArr.splice(i,1);
    else if(c.y>car.y && Math.abs(c.x-car.x)<25){
      coinsArr.splice(i,1); coinCount++;
      const lic=JSON.parse(localStorage.getItem('licenses'));
      lic[licenseCode].coins=coinCount;
      localStorage.setItem('licenses',JSON.stringify(lic));
      loadScores();
    }
  });

  ctx.fillStyle='#222'; ctx.font='20px Vazirmatn'; ctx.fillText('Ø³Ú©Ù‡: '+coinCount,10,30);
}
</script>
</body>
</html>
